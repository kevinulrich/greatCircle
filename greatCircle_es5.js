"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),greatCircle=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"construct",value:function(e){"object"!=typeof e&&(e={}),this.sort=t._getValidSort(e.sort),this.limit=t._getValidLimit(e.sort)}},{key:"calc",value:function(e){if("object"!=typeof e.from||"undefined"==typeof e.from.lat||"undefined"==typeof e.from.lon)throw"greatCircle: From needs to be an object with at least lat and lon";if("object"!=typeof e.to)throw"greatCircle: To needs to be an object with at least lat and lon";var a="undefined"!=typeof e.sort?t._getValidSort(e.sort):this.sort,n=("undefined"!=typeof e.limit?t._getValidLimit(e.limit):this.limit,t._getValidPoint(e.from)),i=t._getValidPointList(e.to),o=t._getDistanceList(n,i);return a!==!1&&t._sortDistanceList(o),o}}],[{key:"_sortDistanceList",value:function(t){return t}},{key:"_getDistanceList",value:function(e,a){e=t._getValidPoint(e),a=t._getValidPointList(a);var n=[];for(var i in a)try{var o=t.getDistanceBetween(e,a[i]);n.push({from:e,to:a[i],distance:o})}catch(r){console.error(r)}return n}},{key:"getDistanceBetween",value:function(e,a){e=t._getValidPoint(e),a=t._getValidPoint(a);var n=t.floatToRadians(e.lat),i=t.floatToRadians(a.lat),o=t.floatToRadians(a.lat-e.lat),r=t.floatToRadians(a.lon-e.lon),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(n)*Math.cos(i)*Math.sin(r/2)*Math.sin(r/2),s=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return t.earthRadius*s}},{key:"_getValidPointList",value:function(e){try{if(!(e instanceof Array))return[t._getValidPoint(e)]}catch(a){return[]}var n=[];for(var i in e)try{n.push(t._getValidPoint(e[i]))}catch(a){console.error(a)}return n}},{key:"_getValidPoint",value:function(t){if("undefined"==typeof t)throw"greatCircle: No coordinates given";if(isNaN(t.lat)||isNaN(t.lon))throw"greatCircle: Invalid coordinates";if(parseFloat(t.lat)<-180||parseFloat(t.lat)>180)throw"greatCircle: Invalid coordinates";if(parseFloat(t.lon)<-180||parseFloat(t.lon)>180)throw"greatCircle: Invalid coordinates";var e={lat:parseFloat(t.lat),lon:parseFloat(t.lon)};return"undefined"!=typeof t.payload&&(e.payload=t.payload),e}},{key:"_getValidSort",value:function(t){return t&&"asc"==t?"asc":t&&"desc"==t?"desc":!1}},{key:"_getValidLimit",value:function(t){return"boolean"==typeof t?!1:null===t?!1:isNaN(t)?!1:parseInt(t)>0?parseInt(t):!1}},{key:"floatToRadians",value:function(t){return t*Math.PI/180}},{key:"earthRadius",value:6371e3,enumerable:!0}]),t}();
